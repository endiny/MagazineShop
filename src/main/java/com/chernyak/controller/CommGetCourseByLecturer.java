package com.chernyak.controller;

import java.io.IOException;
import java.util.List;

import javax.servlet.ServletException;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

import com.chernyak.entity.Course;
import com.chernyak.entity.Lecturer;
import org.apache.log4j.Level;

public class CommGetCourseByLecturer extends Command {
	
    /**
     * Page "sign in" for lecturer
     * @param request
     * @param response
     * @throws ServletException
     * @throws IOException
     */
    @Override
	public void execute(HttpServletRequest request, HttpServletResponse response)
			throws ServletException, IOException {
		    Integer id = 0;
		try {
			id = Integer.valueOf(request.getParameter("id"));
			Lecturer lecturer = clientService.getLecturerById(id);
			String pass = request.getParameter("pass");
			if (lecturer.getPassword().equals(pass)) {
				List<Course> result = clientService.getCoursesByLecturer(id);
				request.setAttribute("result", result);
				request.getServletContext().getRequestDispatcher("/WEB-INF/lecturerCourses.jsp").forward(request, response);
			} else {
                                log.log(Level.INFO, lecturer.toString() + " ???????????????????????? ????????????");
				String message = "???????????????????????? ????????????";
				request.setAttribute("message", message);
			}
		}catch(NullPointerException ex) {
                        log.log(Level.INFO, "???????????? ID");
			String message = "???????????????????? ?????????????? ???????????????????? ID";
			request.setAttribute("message", message);
		}catch(RuntimeException ex) {
                        log.log(Level.INFO, "???????????????????????? ID");
			String message = "???????????????????? ?????????????? ???????????????????? ID";
			request.setAttribute("message", message);
		}
		request.getServletContext().getRequestDispatcher("/WEB-INF/login.jsp").forward(request, response);	
	}

}
